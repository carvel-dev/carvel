<!DOCTYPE html>
<!-- docs/baseof.html -->
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="icon" type="image/png" href="/img/favicon.png">
    
    
    <link rel="stylesheet" href="/css/style.css" integrity="" media="screen">
    <script src="/js/main.js" type="text/javascript"></script>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> 
  
    
      
      <meta name="robots" content="noindex">
    
    <title>Carvel - kapp-controller - Security Model</title>
  </head>

  <body id="docs">
    

<header class="in-subproject">
	<div class="wrapper">
		<a href="/"><img class="image" src="/img/logo.svg" alt="Carvel Logo" /></a>
		<ul class="desktop-links">
			<li><a href="/" >Home</a></li>
			<li class="subprojects-in-primary-nav">
				<a href="/" onclick="return false;">Projects</a>
				<ul>
					
					
					<li><a href="/ytt/" >ytt</a></li>
					
					
					<li><a href="/kbld/" >kbld</a></li>
					
					
					<li><a href="/kapp/" >kapp</a></li>
					
					
					<li><a href="/imgpkg/" >imgpkg</a></li>
					
					
					<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
					
					
					<li><a href="/vendir/" >vendir</a></li>
					
				</ul>
			</li>
			<li><a href="/community/" >Community</a></li>
			<li><a href="/blog/" >Blog</a></li>
			<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a></li>
		</ul>
		<button type="button" class="mobile" onclick="mobileNavToggle()">
			<img class="collapsed-icon" src="/img/hamburger.svg" alt="Mobile nav icon">
			<img class="expanded-icon" src="/img/close.svg" alt="Mobile nav icon">
		</button>
		<div id="mobile-menu" class="mobile-menu mobile">
			<ul class="header-links">
				<li><a href="/" >Home</a></li>
				<li>
					<a href="/">Projects</a>
					<ul>
						
						
						<li><a href="/ytt/" >ytt</a></li>
						
						
						<li><a href="/kbld/" >kbld</a></li>
						
						
						<li><a href="/kapp/" >kapp</a></li>
						
						
						<li><a href="/imgpkg/" >imgpkg</a></li>
						
						
						<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller</a></li>
						
						
						<li><a href="/vendir/" >vendir</a></li>
						
					</ul>
				</li>
				<li><a href="/community/" >Community</a></li>
				<li><a href="/blog/" >Blog</a></li>
			</ul>
			<div class="social">
				<a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />GitHub</a>
				<a href="https://kubernetes.slack.com/archives/CH8KCCKA5"><img src="/img/slack.png" />#carvel in Kubernetes Slack</a>
			</div>
		</div>
	</div>
</header>



<header class="subproject-specific">
	<div class="wrapper">
		<a href="https://github.com/vmware-tanzu/carvel-kapp-controller" class="text-logo">kapp-controller</a>
		<ul class="desktop-links">
			<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller" >kapp-controller Overview</a></li>
			<li><a href="/kapp-controller/docs/latest/" >Documentation</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
		<ul class="mobile-links mobile">
			<li><a href="/kapp-controller/docs/latest/" >Docs</a></li>
			<li><a href="https://github.com/vmware-tanzu/carvel-kapp-controller"><img src="/img/github.svg" />GitHub</a></li>
		</ul>
	</div>
</header>


    <main>
      <div class="wrapper dedicated-page docs clearfix">
        <div class="side-nav">
          
<div class="dropdown">
    
        <span>latest</span>
    
</div>

          
    
    <form class="d-flex align-items-center">
        <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
        <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                dir="auto" style="position: relative; vertical-align: top;">
        </span>
    </form>

          <nav class="navigation">
  
  
  
  
    
    
    
    

    
      <h3>Introduction</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/" >About kapp-controller</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/install/" >Install</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/walkthrough/" >Walkthrough</a>
            
          </li>
        
      </ul>
    
      <h3>Reference</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/app-spec/" >App CR Spec</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/config/" >Configuration</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/controller-config/" >Controller Configuration</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/startup/" >Controller Startup</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/security-model/" class="active">Security Model</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/dangerous-flags/" >Dangerous Flags</a>
            
          </li>
        
      </ul>
    
      <h3>Template steps</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/sops/" >Mozilla&#39;s sops</a>
            
          </li>
        
      </ul>
    
      <h3>Packaging (alpha)</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/packaging/" >Terminology &amp; APIs</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/install-alpha/" >Install</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/package-authoring/" >Authoring packages</a>
            
          </li>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/package-consumption/" >Consuming packages</a>
            
          </li>
        
      </ul>
    
      <h3>FAQ</h3>
      <ul>
        
          <li>
            
              
              <a href="/kapp-controller/docs/latest/security/" >Security</a>
            
          </li>
        
      </ul>
    
  
</nav>

        </div>
        <div class="docs-content text-content">
          

	


          <div class="documentation-container">
            <h1>Security Model</h1>
            
                <aside>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#app-cr-privileges">App CR privileges</a></li>
    <li><a href="#minimum-serviceaccount-permissions">Minimum ServiceAccount Permissions</a></li>
  </ul>
</nav>
                </aside>
            

            <h2 id="app-cr-privileges">App CR privileges <a href="#app-cr-privileges" class="section-link">¶</a></h2><p>kapp-controller container runs with a service account (named <code>kapp-controller-sa</code> inside <code>kapp-controller</code> namespace) that has access to all service accounts and secrets in the cluster. This service account <em>is not</em> used for deployment of app resources.</p>
<p>Each App CR <em>must</em> specify either a</p>
<ul>
<li>service account (via <code>spec.serviceAccountName</code>)</li>
<li>or, Secret with kubeconfig contents for some cluster (via <code>spec.cluster.kubeconfigSecretRef.name</code>)</li>
</ul>
<p>forcing App CR owner to explicitly provide needed privileges for management of app resources. This avoids a problem of privilege escalation commonly found in other general resource controllers which rely on a shared service account (often requiring cluster admin privileges) to deploy resources.</p>
<p>Since App CR only allows to reference service account or kubeconfig Secret within the same namespace where App CR is located, kapp-controller is well suited for multi-tenant use where different users of App CRD have varied level of access (e.g. some may have cluster level privileges, and other may only have access to one or more namespace).</p>
<p>Example:</p>
<ul>
<li>
<p>User A has been granted access to namespace <code>a</code> (and no other namespace or cluster level access). User A can create an App CR with a service account located in namespace <code>a</code> to deploy resources into namespace <code>a</code>. It <em>is not</em> possible for user A to create an App CR that would install cluster-wide resources or place resources into another namespace. (e.g. a user that just deploys web application to their namespace)</p>
</li>
<li>
<p>User B has been granted access to namespace <code>b</code> and ability to manage specifically named CRD (single scoped cluster-wide privilege). User B can create an App CR with a service account located in namespace <code>b</code> that installs app into namespace <code>b</code> and also manages single CRD lifecycle. (e.g. a user that manages another controller for other users)</p>
</li>
</ul>
<h2 id="minimum-serviceaccount-permissions">Minimum ServiceAccount Permissions <a href="#minimum-serviceaccount-permissions" class="section-link">¶</a></h2><p>For users managing App and InstalledPackage CR privileges via a service account, the verbs in the role below are needed for working with ConfigMaps.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">kind</span>:<span style="color:#bbb"> </span>Role<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">apiVersion</span>:<span style="color:#bbb"> </span>rbac.authorization.k8s.io/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>app-ip-cr-role<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#000080">rules</span>:<span style="color:#bbb">
</span><span style="color:#bbb"></span>- <span style="color:#000080">apiGroups</span>:<span style="color:#bbb"> </span>[<span style="color:#d14">&#34;&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">resources</span>:<span style="color:#bbb"> </span>[<span style="color:#d14">&#34;configmaps&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">verbs</span>:<span style="color:#bbb"> </span>[<span style="color:#d14">&#34;get&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;list&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;create&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;update&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;delete&#34;</span>]<span style="color:#bbb">
</span></code></pre></div><p>These permissions are needed because of how <code>kapp</code> tracks information about apps it manages, which is via storing information in a ConfigMap. So even if your App or InstalledPackage CR does not create ConfigMaps, the service account will still need permissions for working with ConfigMaps.</p>
<p>The ConfigMap permissions above are needed in addition to any other resource/verb combinations needed to deploy all resources created by the App and InstalledPackage CRs.</p>

          </div>
        </div>
      </div>
    </main>
    <footer>
	<div class="wrapper footer-links">
		<div class="clearfix">
			<ul class="left-links">
				<li><a href="https://twitter.com/carvel_dev"><img src="/img/twitter.png" />Twitter</a></li>
				<li><a href="https://github.com/vmware-tanzu/carvel.dev"><img src="/img/github.svg" />Github</a></li>
				<li><a href="https://kubernetes.slack.com/archives/CH8KCCKA5">
					<img src="/img/slack.png" />
					<span class="desktop">#carvel in Kubernetes Slack</span>
					<span class="mobile">Slack</span>
				</a></li>
			</ul>
			<div class="right-links">
				<a href="/"> <img src="/img/logo.svg" /></a>
			</div>
		</div>
		<div class="bottom-links">
			<p class="copywrite">&copy; 2021 Carvel Authors. <a href="http://vmware.github.io/">A VMware-backed project. <img src="/img/vm-logo.svg" /></a></p>
		</div>
	</div>
</footer>

    
    
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
      <script type="text/javascript">
        docsearch({
          apiKey: '582b1408d7a3fe145c0f84f48ca03755',
          indexName: 'carvel',
          inputSelector: '.docsearch-input',
          algoliaOptions: {'facetFilters': ["tags:kapp-controller"], hitsPerPage: 9},
          debug: false 
        });
      </script>
    
  </body>
</html>
